var style=document.createElement("style"),fonteFiraSans=new FontFace("Fira Sans",'url("./FiraSans-Italic.ttf")');function generateGrid(){const e=document.getElementById("userInput").value,t=document.getElementById("timeRange").value,a=document.getElementById("gridSize").value,o=document.getElementById("showAlbumName").checked,n=document.getElementById("showAlbumPlaycount").checked,l=document.getElementById("albumGrid");let s=18,d="";switch(d="user.getTopAlbums",a){case"3":s=18,placeY=18;break;case"4":s=16,placeY=14;break;case"5":s=14,placeY=12;break;case"6":case"7":s=12,placeY=10}fetch(`https://ws.audioscrobbler.com/2.0/?method=${d}&user=${e}&period=${t}&api_key=e713e4ee81e3cfee0417956233a9faa1&format=json`).then((e=>e.json())).then((e=>{const t=a*a,d=document.createElement("canvas");d.width=1250,d.height=1250;const c=d.getContext("2d");let i=0;const r=()=>{if(i++,i===t){const e=document.createElement("img");e.src=d.toDataURL(),e.alt="Generated Album Grid",e.className="generated-image",l.innerHTML="",l.appendChild(e);document.getElementById("downloadButton").style.display="block"}};e.topalbums.album.slice(0,t).forEach(((e,t)=>{const l=new Image;l.src=e.image[3]["#text"],l.crossOrigin="Anonymous",l.onload=function(){const i=t%a*(d.width/a),m=Math.floor(t/a)*(d.height/a);if(c.drawImage(l,i,m,d.width/a,d.height/a),o){c.font=`${s}px Fira Sans`,c.shadowColor="#2b2b2b",c.shadowBlur=.3,c.shadowOffsetX=1,c.shadowOffsetY=1,c.fillStyle="white",c.fillText(e.artist.name,i+2,m+placeY);const t=`${e.artist.name} - ${e.name}`,a=c.measureText(t).width;if(a>l.width){const e=l.width/a,t=s*e;c.font=`${t}px Fira Sans`}c.fillText(e.name,i+2,m+(placeY+16))}n&&(c.font=`${s}px Fira Sans`,c.shadowColor="#2b2b2b",c.shadowBlur=.3,c.shadowOffsetX=1,c.shadowOffsetY=1,c.fillStyle="white",c.fillText(`Plays: ${e.playcount}`,i+2,m+(placeY+32))),r()},l.onerror=function(){const l=t%a*(d.width/a),i=Math.floor(t/a)*(d.height/a);c.fillStyle="black",c.fillRect(l,i,d.width/a,d.height/a),o&&(c.font=`${s}px Fira Sans`,c.shadowColor="#2b2b2b",c.shadowBlur=.3,c.shadowOffsetX=1,c.shadowOffsetY=1,c.fillStyle="white",c.fillText(e.artist.name,l+2,i+placeY),c.fillText(e.name,l+2,i+(placeY+16))),n&&(c.font=`${s}px Fira Sans`,c.shadowColor="#2b2b2b",c.shadowBlur=.3,c.shadowOffsetX=1,c.shadowOffsetY=1,c.fillStyle="white",c.fillText(`Plays: ${e.playcount}`,l+2,i+(placeY+32))),r()}}))})).catch((e=>{console.error("Erro ao obter os dados do Last.fm:",e),alert("Erro ao obter os dados do Last.fm. Verifique o nome de usu√°rio e tente novamente.")}))}function downloadGrid(){const e=document.querySelector(".generated-image");if(e){const t=document.createElement("a");t.href=e.src,t.download="semaninha.png",document.body.appendChild(t),t.click(),document.body.removeChild(t)}else alert("Sem imagem para baixar!")}fonteFiraSans.load().then((function(e){document.fonts.add(e),style.appendChild(document.createTextNode("\n    @font-face {\n      font-family: 'Fira Sans';\n      src: url('./FiraSans-Italic.ttf') format('truetype');\n    }\n  ")),document.head.appendChild(style)}));