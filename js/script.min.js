const API_KEY="e713e4ee81e3cfee0417956233a9faa1",FONT_NAME="Fira Sans",FONT_URL="./FiraSans-Italic.ttf";let fontSize=18,placeY=18;function setFont(e,t){e.font=`${t}px ${FONT_NAME}`,e.shadowColor="#2b2b2b",e.shadowBlur=.3,e.shadowOffsetX=1,e.shadowOffsetY=1,e.fillStyle="white"}async function loadFontAndStyle(){const e=document.createElement("style"),t=new FontFace(FONT_NAME,`url("${FONT_URL}")`);try{await t.load(),document.fonts.add(t),e.appendChild(document.createTextNode(`\n      @font-face {\n        font-family: '${FONT_NAME}';\n        src: url('${FONT_URL}') format('truetype');\n      }\n    `)),document.head.appendChild(e)}catch(e){console.error("Erro ao carregar a fonte:",e)}}function generateGrid(){const e=document.getElementById("userInput").value,t=document.getElementById("timeRange").value,o=document.getElementById("gridSize").value,n=document.getElementById("showAlbumName").checked,a=document.getElementById("showAlbumPlaycount").checked,c=document.getElementById("albumGrid");let l="";switch(l="user.getTopAlbums",o){case"3":fontSize=18,placeY=18;break;case"4":fontSize=16,placeY=14;break;case"5":fontSize=14,placeY=12;break;case"6":case"7":fontSize=12,placeY=10}fetch(`https://ws.audioscrobbler.com/2.0/?method=${l}&user=${e}&period=${t}&api_key=${API_KEY}&format=json`).then((e=>e.json())).then((e=>{const t=o*o,l=document.createElement("canvas");l.width=1250,l.height=1250;const d=l.getContext("2d");let r=0;const i=()=>{if(r++,r===t){const e=document.createElement("img");e.src=l.toDataURL(),e.alt="Generated Album Grid",e.className="generated-image",c.innerHTML="",c.appendChild(e);document.getElementById("downloadButton").style.display="block"}};e.topalbums.album.slice(0,t).forEach(((e,t)=>{const c=new Image;c.src=e.image[3]["#text"],c.crossOrigin="Anonymous",c.onload=function(){const r=t%o*(l.width/o),s=Math.floor(t/o)*(l.height/o);d.drawImage(c,r,s,l.width/o,l.height/o),n&&(setFont(d,fontSize),d.fillText(e.artist.name,r+2,s+placeY),d.fillText(e.name,r+2,s+(placeY+16))),a&&(setFont(d,fontSize),d.fillText(`Plays: ${e.playcount}`,r+2,s+(placeY+32))),i()},c.onerror=function(){const e=t%o*(l.width/o),n=Math.floor(t/o)*(l.height/o);d.fillStyle="black",d.fillRect(e,n,l.width/o,l.height/o),i()}}))})).catch((e=>{console.error("Erro ao obter os dados do Last.fm:",e),alert("Erro ao obter os dados do Last.fm. Verifique o nome de usu√°rio e tente novamente.")}))}function downloadGrid(){const e=document.querySelector(".generated-image");if(e){const t=document.createElement("a");t.href=e.src,t.download="semaninha.png",document.body.appendChild(t),t.click(),document.body.removeChild(t)}else alert("Sem imagem para baixar!")}loadFontAndStyle();
