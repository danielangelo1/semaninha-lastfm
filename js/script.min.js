const API_KEY="e713e4ee81e3cfee0417956233a9faa1",FONT_NAME="Fira Sans",FONT_URL="./FiraSans-Italic.ttf";function setFont(e,t){e.font=`${t}px ${FONT_NAME}`,e.shadowColor="#2b2b2b",e.shadowBlur=.3,e.shadowOffsetX=1,e.shadowOffsetY=1,e.fillStyle="white"}async function loadFontAndStyle(){const e=document.createElement("style"),t=new FontFace(FONT_NAME,`url("${FONT_URL}")`);try{await t.load(),document.fonts.add(t),e.appendChild(document.createTextNode(`\n        @font-face {\n          font-family: '${FONT_NAME}';\n          src: url('${FONT_URL}') format('truetype');\n        }\n      `)),document.head.appendChild(e)}catch(e){console.error("Erro ao carregar a fonte:",e)}}function generateGrid(){const e=document.getElementById("userInput").value,t=document.getElementById("timeRange").value,o=document.getElementById("gridSize").value,n=document.getElementById("showAlbumName").checked,a=document.getElementById("showAlbumPlaycount").checked,l=document.getElementById("albumGrid");let c="";c="user.getTopAlbums";let d=18,r=18;switch(o){case"3":d=18,r=18;break;case"4":d=16,r=14;break;case"5":d=14,r=12;break;case"6":case"7":d=12,r=10}fetch(`https://ws.audioscrobbler.com/2.0/?method=${c}&user=${e}&period=${t}&api_key=${API_KEY}&limit=${o*o}&format=json`).then((e=>e.json())).then((e=>{const t=o*o,c=document.createElement("canvas");c.width=1250,c.height=1250;const s=c.getContext("2d");let i=0;const m=()=>{if(i++,i===t){const e=document.createElement("img");e.src=c.toDataURL(),e.alt="Generated Album Grid",e.className="generated-image",l.innerHTML="",l.appendChild(e);document.getElementById("downloadButton").style.display="block"}};e.topalbums.album.slice(0,t).forEach(((e,t)=>{const l=new Image;l.src=e.image[3]["#text"],l.crossOrigin="Anonymous",l.onload=function(){const i=t%o*(c.width/o),u=Math.floor(t/o)*(c.height/o);s.drawImage(l,i,u,c.width/o,c.height/o),n&&(setFont(s,d),s.fillText(e.artist.name,i+2,u+r),s.fillText(e.name,i+2,u+(r+16))),a&&(setFont(s,d),s.fillText(`Plays: ${e.playcount}`,i+2,u+(r+32))),m()},l.onerror=function(){const l=t%o*(c.width/o),i=Math.floor(t/o)*(c.height/o);s.fillStyle="black",s.fillRect(l,i,c.width/o,c.height/o),n&&(setFont(s,d),s.fillText(e.artist.name,l+2,i+r),s.fillText(e.name,l+2,i+(r+16))),a&&(setFont(s,d),s.fillText(`Plays: ${e.playcount}`,l+2,i+(r+32))),m()}}))})).catch((e=>{console.error("Erro ao obter os dados do Last.fm:",e),alert("Erro ao obter os dados do Last.fm. Verifique o nome de usu√°rio e tente novamente.")}))}function downloadGrid(){const e=document.querySelector(".generated-image");if(e){const t=document.createElement("a");t.href=e.src,t.download="semaninha.png",document.body.appendChild(t),t.click(),document.body.removeChild(t)}else alert("Sem imagem para baixar!")}loadFontAndStyle();
