function generateGrid(){const e=document.getElementById("userInput").value,t=document.getElementById("timeRange").value,o=document.getElementById("gridSize").value,a=document.getElementById("showAlbumName").checked,n=document.getElementById("showAlbumPlaycount").checked,l=document.getElementById("albumGrid");let d=18,s="";switch(s="user.getTopAlbums",o){case"3":d=18;break;case"4":d=16;break;case"5":d=14}fetch(`https://ws.audioscrobbler.com/2.0/?method=${s}&user=${e}&period=${t}&api_key=e713e4ee81e3cfee0417956233a9faa1&format=json`).then((e=>e.json())).then((e=>{const t=o*o,s=document.createElement("canvas");s.width=1250,s.height=1250;const i=s.getContext("2d");let r=0;const c=()=>{if(r++,r===t){const e=document.createElement("img");e.src=s.toDataURL(),e.alt="Generated Album Grid",e.className="generated-image",l.innerHTML="",l.appendChild(e);document.getElementById("downloadButton").style.display="block"}};e.topalbums.album.slice(0,t).forEach(((e,t)=>{const l=new Image;l.src=e.image[3]["#text"],l.crossOrigin="Anonymous",l.onload=function(){const r=t%o*(s.width/o),m=Math.floor(t/o)*(s.height/o);if(i.drawImage(l,r,m,s.width/o,s.height/o),a){i.font=`${d}px Arial`,i.shadowColor="#2b2b2b",i.shadowBlur=5,i.shadowOffsetX=2,i.shadowOffsetY=2,i.fillStyle="white",i.fillText(e.artist.name,r+2,m+20);const t=`${e.artist.name} - ${e.name}`,o=i.measureText(t).width;if(o>l.width){const e=l.width/o,t=d*e;i.font=`${t}px Arial`}i.fillText(e.name,r+2,m+40)}n&&(i.font=`${d}px Arial`,i.shadowColor="#2b2b2b",i.shadowBlur=5,i.shadowOffsetX=2,i.shadowOffsetY=2,i.fillStyle="white",i.fillText(`Plays: ${e.playcount}`,r+2,m+60)),c()},l.onerror=function(){const l=t%o*(s.width/o),r=Math.floor(t/o)*(s.height/o);i.fillStyle="black",i.fillRect(l,r,s.width/o,s.height/o),a&&(i.font=`${d}px Arial`,i.shadowColor="#2b2b2b",i.shadowBlur=5,i.shadowOffsetX=2,i.shadowOffsetY=2,i.fillStyle="white !important",i.fillText(e.artist.name,l+2,r+20),i.fillText(e.name,l+2,r+40)),n&&(i.font=`${d}px Arial`,i.shadowColor="#2b2b2b",i.shadowBlur=5,i.shadowOffsetX=2,i.shadowOffsetY=2,i.fillStyle="white !important",i.fillText(`Plays: ${e.playcount}`,l+2,r+60)),c()}}))})).catch((e=>{console.error("Erro ao obter os dados do Last.fm:",e),alert("Erro ao obter os dados do Last.fm. Verifique o nome de usu√°rio e tente novamente.")}))}function downloadGrid(){const e=document.querySelector(".generated-image");if(e){const t=document.createElement("a");t.href=e.src,t.download="semaninha.png",document.body.appendChild(t),t.click(),document.body.removeChild(t)}else alert("Sem imagem para baixar!")}
