const API_KEY="e713e4ee81e3cfee0417956233a9faa1",FONT_NAME="Fira Sans",FONT_URL="./FiraSans-Italic.ttf";function setFont(e,t){e.font=`${t}px ${FONT_NAME}`,e.shadowColor="#2b2b2b",e.shadowBlur=.3,e.shadowOffsetX=1,e.shadowOffsetY=1,e.fillStyle="white"}async function loadFontAndStyle(){let e=document.createElement("style"),t=new FontFace(FONT_NAME,`url("${FONT_URL}")`);try{await t.load(),document.fonts.add(t),e.appendChild(document.createTextNode(`
        @font-face {
          font-family: '${FONT_NAME}';
          src: url('${FONT_URL}') format('truetype');
        }
      `)),document.head.appendChild(e)}catch(a){console.error("Erro ao carregar a fonte:",a)}}function generateGrid(){let e=document.getElementById("userInput").value,t=document.getElementById("timeRange").value,a=document.getElementById("gridSize").value,l=document.getElementById("showAlbumName").checked,o=document.getElementById("showAlbumPlaycount").checked,n="albums",i=document.getElementById("albumGrid");saveValuesLocalStorage(e,t,a,l,o);let s="";"albums"===n?s="user.getTopAlbums":"artists"===n&&(s="user.getTopArtists");let r=18,d=18;switch(a){case"3":r=18,d=18;break;case"4":r=16,d=14;break;case"5":r=14,d=12;break;case"6":case"7":r=12,d=10}fetch(`https://ws.audioscrobbler.com/2.0/?method=${s}&user=${e}&period=${t}&api_key=e713e4ee81e3cfee0417956233a9faa1&limit=${a*a}&format=json`).then(e=>e.json()).then(e=>{let t=a*a,s=document.createElement("canvas");s.width=1250,s.height=1250;let m=s.getContext("2d"),c=0,u=()=>{if(++c===t){let e=document.createElement("img");e.src=s.toDataURL(),e.alt="albums"===n?"Generated Album Grid":"Generated Artist Grid",e.className="generated-image",i.innerHTML="",i.appendChild(e);let a=document.getElementById("downloadButton");a.style.display="block"}};if("albums"===n){let h=e.topalbums.album.slice(0,t);h.forEach((e,t)=>{let n=new Image;n.src=e.image[3]["#text"],n.crossOrigin="Anonymous",n.onload=function(){let i=t%a*(s.width/a),c=Math.floor(t/a)*(s.height/a);m.drawImage(n,i,c,s.width/a,s.height/a),l&&(setFont(m,r),m.fillText(e.artist.name,i+2,c+d),m.fillText(e.name,i+2,c+(d+16))),o&&(setFont(m,r),m.fillText(`Plays: ${e.playcount}`,i+2,c+(d+32))),u()},n.onerror=function(){let n=t%a*(s.width/a),i=Math.floor(t/a)*(s.height/a);m.fillStyle="black",m.fillRect(n,i,s.width/a,s.height/a),l&&(setFont(m,r),m.fillText(e.artist.name,n+2,i+d),m.fillText(e.name,n+2,i+(d+16))),o&&(setFont(m,r),m.fillText(`Plays: ${e.playcount}`,n+2,i+(d+32))),u()}})}else if("artists"===n){let g=e.topartists.artist.slice(0,t);g.forEach((e,t)=>{let n=new Image;n.src=e.image[3]["#text"],n.crossOrigin="Anonymous",n.onload=function(){let i=t%a*(s.width/a),d=Math.floor(t/a)*(s.height/a);m.drawImage(n,i,d,s.width/a,s.height/a),l&&(setFont(m,r),m.fillText(e.name,i+5,d+20)),o&&(setFont(m,r),m.fillText(`Plays: ${e.playcount}`,i+5,d+40)),u()},n.onerror=function(){let e=t%a*(s.width/a),l=Math.floor(t/a)*(s.height/a);m.fillStyle="black",m.fillRect(e,l,s.width/a,s.height/a),u()}})}}).catch(e=>{console.error("Erro ao obter os dados do Last.fm:",e),alert("Erro ao obter os dados do Last.fm. Verifique o nome de usu\xe1rio e tente novamente.")})}function downloadGrid(){let e=document.querySelector(".generated-image");if(e){let t=document.createElement("a");t.href=e.src,t.download="semaninha.png",document.body.appendChild(t),t.click(),document.body.removeChild(t)}else alert("Sem imagem para baixar!")}function saveValuesLocalStorage(e,t,a,l,o){localStorage.setItem("userInput",e),localStorage.setItem("timeRange",t),localStorage.setItem("gridSize",a),localStorage.setItem("showAlbumName",l),localStorage.setItem("showAlbumPlaycount",o)}function loadValuesLocalStorage(){let e=localStorage.getItem("userInput"),t=localStorage.getItem("timeRange"),a=localStorage.getItem("gridSize"),l=localStorage.getItem("showAlbumName"),o=localStorage.getItem("showAlbumPlaycount");e&&(document.getElementById("userInput").value=e),t&&(document.getElementById("timeRange").value=t),a&&(document.getElementById("gridSize").value=a),l&&(document.getElementById("showAlbumName").checked=l),o&&(document.getElementById("showAlbumPlaycount").checked=o)}loadFontAndStyle(),loadValuesLocalStorage();