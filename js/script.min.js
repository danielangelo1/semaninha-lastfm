function generateGrid(){const e=document.getElementById("userInput").value,t=document.getElementById("timeRange").value,a=document.getElementById("gridSize").value,o=document.getElementById("showAlbumName").checked,l=document.getElementById("showAlbumPlaycount").checked,n=document.getElementById("albumGrid");let s=18,d="";switch(d="user.getTopAlbums",a){case"3":s=18,placeY=20;break;case"4":s=16,placeY=18;break;case"5":s=14,placeY=16;break;case"6":s=12,placeY=14;break;case"7":s=12,placeY=12}fetch(`https://ws.audioscrobbler.com/2.0/?method=${d}&user=${e}&period=${t}&api_key=e713e4ee81e3cfee0417956233a9faa1&format=json`).then((e=>e.json())).then((e=>{const t=a*a,d=document.createElement("canvas");d.width=1250,d.height=1250;const c=d.getContext("2d");let i=0;const r=()=>{if(i++,i===t){const e=document.createElement("img");e.src=d.toDataURL(),e.alt="Generated Album Grid",e.className="generated-image",n.innerHTML="",n.appendChild(e);document.getElementById("downloadButton").style.display="block"}};e.topalbums.album.slice(0,t).forEach(((e,t)=>{const n=new Image;n.src=e.image[3]["#text"],n.crossOrigin="Anonymous",n.onload=function(){const i=t%a*(d.width/a),m=Math.floor(t/a)*(d.height/a);if(c.drawImage(n,i,m,d.width/a,d.height/a),o){c.font=`${s}px Arial`,c.shadowColor="#2b2b2b",c.shadowBlur=1,c.shadowOffsetX=1,c.shadowOffsetY=1,c.fillStyle="white",c.fillText(e.artist.name,i+2,m+placeY);const t=`${e.artist.name} - ${e.name}`,a=c.measureText(t).width;if(a>n.width){const e=n.width/a,t=s*e;c.font=`${t}px Arial`}c.fillText(e.name,i+2,m+(placeY+20))}l&&(c.font=`${s}px Arial`,c.shadowColor="#2b2b2b",c.shadowBlur=1,c.shadowOffsetX=1,c.shadowOffsetY=1,c.fillStyle="white",c.fillText(`Plays: ${e.playcount}`,i+2,m+(placeY+40))),r()},n.onerror=function(){const n=t%a*(d.width/a),i=Math.floor(t/a)*(d.height/a);c.fillStyle="black",c.fillRect(n,i,d.width/a,d.height/a),o&&(c.font=`${s}px Arial`,c.shadowColor="#2b2b2b",c.shadowBlur=1,c.shadowOffsetX=1,c.shadowOffsetY=1,c.fillStyle="white",c.fillText(e.artist.name,n+2,i+placeY),c.fillText(e.name,n+2,i+(placeY+20))),l&&(c.font=`${s}px Arial`,c.shadowColor="#2b2b2b",c.shadowBlur=1,c.shadowOffsetX=1,c.shadowOffsetY=1,c.fillStyle="white",c.fillText(`Plays: ${e.playcount}`,n+2,i+(placeY+40))),r()}}))})).catch((e=>{console.error("Erro ao obter os dados do Last.fm:",e),alert("Erro ao obter os dados do Last.fm. Verifique o nome de usu√°rio e tente novamente.")}))}function downloadGrid(){const e=document.querySelector(".generated-image");if(e){const t=document.createElement("a");t.href=e.src,t.download="semaninha.png",document.body.appendChild(t),t.click(),document.body.removeChild(t)}else alert("Sem imagem para baixar!")}
