function generateGrid(){const e=document.getElementById("userInput").value,t=document.getElementById("timeRange").value,o=document.getElementById("gridSize").value,a=document.getElementById("showAlbumName").checked,l=document.getElementById("showAlbumPlaycount").checked,n=document.getElementById("albumGrid");let d="";d="user.getTopAlbums",fetch(`https://ws.audioscrobbler.com/2.0/?method=${d}&user=${e}&period=${t}&api_key=e713e4ee81e3cfee0417956233a9faa1&format=json`).then((e=>e.json())).then((e=>{const t=o*o,d=document.createElement("canvas");d.width=1250,d.height=1250;const s=d.getContext("2d");let i=0;const r=()=>{if(i++,i===t){const e=document.createElement("img");e.src=d.toDataURL(),e.alt="Generated Album Grid",e.className="generated-image",n.innerHTML="",n.appendChild(e);document.getElementById("downloadButton").style.display="block"}};e.topalbums.album.slice(0,t).forEach(((e,t)=>{const n=new Image;n.src=e.image[3]["#text"],n.crossOrigin="Anonymous",n.onload=function(){const i=t%o*(d.width/o),c=Math.floor(t/o)*(d.height/o);if(s.drawImage(n,i,c,d.width/o,d.height/o),a){s.font="18px Arial",s.shadowColor="#2b2b2b",s.shadowBlur=5,s.shadowOffsetX=2,s.shadowOffsetY=2,s.fillStyle="white",s.fillText(e.artist.name,i+5,c+20);const t=`${e.artist.name} - ${e.name}`,o=s.measureText(t).width;if(o>n.width){const e=18*(n.width/o);s.font=`${e}px Arial`}s.fillText(e.name,i+5,c+40)}l&&(s.font="18px Arial",s.shadowColor="#2b2b2b",s.shadowBlur=5,s.shadowOffsetX=2,s.shadowOffsetY=2,s.fillStyle="white",s.fillText(`Plays: ${e.playcount}`,i+5,c+60)),r()},n.onerror=function(){const n=t%o*(d.width/o),i=Math.floor(t/o)*(d.height/o);s.fillStyle="black",s.fillRect(n,i,d.width/o,d.height/o),a&&(s.font="18px Arial",s.shadowColor="#2b2b2b",s.shadowBlur=5,s.shadowOffsetX=2,s.shadowOffsetY=2,s.fillStyle="white",s.fillText(e.artist.name,n+5,i+20),s.fillText(e.name,n+5,i+40)),l&&(s.font="18px Arial",s.shadowColor="#2b2b2b",s.shadowBlur=5,s.shadowOffsetX=2,s.shadowOffsetY=2,s.fillStyle="white",s.fillText(`Plays: ${e.playcount}`,n+5,i+60)),r()}}))})).catch((e=>{console.error("Erro ao obter os dados do Last.fm:",e),alert("Erro ao obter os dados do Last.fm. Verifique o nome de usu√°rio e tente novamente.")}))}function downloadGrid(){const e=document.querySelector(".generated-image");if(e){const t=document.createElement("a");t.href=e.src,t.download="semaninha.png",document.body.appendChild(t),t.click(),document.body.removeChild(t)}else alert("Sem imagem para baixar!")}
